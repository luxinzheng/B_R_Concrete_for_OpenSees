#===============================================================================
# ADINA混凝土本构 - 简化测试版
#
# 文件: test_adina_simple.tcl
# 用途: 快速验证ADINA本构是否正常工作
#===============================================================================

wipe
model basic -ndm 3 -ndf 6

puts ""
puts "=========================================="
puts "ADINA混凝土本构 - 简化测试"
puts "=========================================="
puts ""

#-------------------------------------------------------------------------------
# 材料定义
#-------------------------------------------------------------------------------

puts "定义材料..."

# C30混凝土参数
set Ec     30.0e9
set nu     0.2
set ft     2.0e6
set fc     30.0e6
set epsc   0.002
set fu     15.0e6
set epsu   0.0035
set beta   0.6
set gama   3.0
set rkapa  0.85
set alfa   -0.05
set stifac 0.02
set shefac 0.2

# ADINA混凝土材料 (21个状态变量)
nDMaterial PlaneStressUserMaterial 1 21 13 \
    $Ec $nu $ft $fc $epsc $fu $epsu \
    $beta $gama $rkapa $alfa $stifac $shefac

puts "  混凝土材料定义完成"

# 面外剪切
set G [expr $Ec / (2.0 * (1.0 + $nu))]
nDMaterial PlateFromPlaneStress 4 1 $G

puts "  平板材料定义完成"

# 钢筋
uniaxialMaterial Steel02 7 379e6 202.7e9 0.01 18.5 0.925 0.15
nDMaterial PlateRebar 9 7 90

puts "  钢筋材料定义完成"

# 截面 (简化为单层)
section LayeredShell 1 1 4 0.125

puts "  截面定义完成"
puts ""

#-------------------------------------------------------------------------------
# 建立简单模型 (1个单元)
#-------------------------------------------------------------------------------

puts "建立几何模型..."

# 4个节点 (1m x 1m)
node 1 0.0 0.0 0.0
node 2 1.0 0.0 0.0
node 3 1.0 1.0 0.0
node 4 0.0 1.0 0.0

puts "  节点定义完成 (4个)"

# 1个壳单元
element ShellMITC4 1 1 2 3 4 1

puts "  单元定义完成 (1个)"

# 边界条件
fix 1 1 1 1 1 1 1
fix 2 1 1 1 1 1 1

puts "  边界条件定义完成"
puts ""

#-------------------------------------------------------------------------------
# 施加荷载
#-------------------------------------------------------------------------------

puts "施加荷载..."

pattern Plain 1 Linear {
    load 3 0 -10000 0 0 0 0
}

puts "  节点3施加竖向荷载: -10 kN"
puts ""

#-------------------------------------------------------------------------------
# 分析设置
#-------------------------------------------------------------------------------

puts "分析设置..."

constraints Plain
numberer Plain
system BandGeneral
test NormDispIncr 1.0e-6 100 2
algorithm Newton
integrator LoadControl 1.0
analysis Static

puts "  约束: Plain"
puts "  系统: BandGeneral"
puts "  算法: Newton"
puts "  步长: 1.0"
puts ""

#-------------------------------------------------------------------------------
# 执行分析
#-------------------------------------------------------------------------------

puts "开始分析..."
puts ""

set ok [analyze 1]

if {$ok == 0} {
    puts "=========================================="
    puts "分析成功!"
    puts "=========================================="
    puts ""
    
    # 输出结果
    puts "节点3位移:"
    print node 3
    puts ""
    
    puts "单元1应力:"
    print element 1
    puts ""
    
} else {
    puts "=========================================="
    puts "分析失败!"
    puts "=========================================="
    puts ""
    
    puts "请检查:"
    puts "  1. ADINA本构库是否正确编译"
    puts "  2. 材料参数是否合理"
    puts "  3. 状态变量数是否正确设置(21)"
    puts ""
}

wipe
puts "测试完成"
puts ""
